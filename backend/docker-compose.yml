version: '3.8'

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: aidp-render-api
    ports:
      - "8000:8000"
    volumes:
      - ./app:/app/app
      - ./storage:/app/storage
    environment:
      # AIDP Configuration
      - AIDP_API_URL=${AIDP_API_URL:-https://api.aidp.store}
      - AIDP_API_KEY=${AIDP_API_KEY:-your_api_key_here}
      - AIDP_NETWORK_ID=${AIDP_NETWORK_ID:-mainnet}

      # Application Configuration
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-http://localhost:5173,https://proofrender.vercel.app}
      - MAX_UPLOAD_SIZE=${MAX_UPLOAD_SIZE:-10485760}
      - RATE_LIMIT_REQUESTS=${RATE_LIMIT_REQUESTS:-5}
      - RATE_LIMIT_WINDOW=${RATE_LIMIT_WINDOW:-3600}

      # Storage Configuration
      - STORAGE_PATH=${STORAGE_PATH:-/app/storage}
      - FILE_TTL_HOURS=${FILE_TTL_HOURS:-24}

      # Blender Configuration
      - BLENDER_BINARY=${BLENDER_BINARY:-/usr/bin/blender}
      - RENDER_RESOLUTION=${RENDER_RESOLUTION:-1024x1024}
      - RENDER_SAMPLES=${RENDER_SAMPLES:-128}
      - RENDER_TIMEOUT=${RENDER_TIMEOUT:-300}
    env_file:
      - .env
    restart: unless-stopped
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

volumes:
  storage:
